<%--
  Created by IntelliJ IDEA.
  User: Persist
  Date: 2018/7/3
  Time: 11:41
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ include file="../../../public/tag.jsp" %>
<html>
<head>
    <title>开放试题</title>
    <link rel="stylesheet" href="${baseurl}/public/common/layui/css/layui.css" media="all">
    <link rel="stylesheet" type="text/css" href="${baseurl}/public/common/layui/css/layui.css" media="all">
    <link rel="stylesheet" type="text/css" href="${baseurl}/public/common/bootstrap/css/bootstrap.min.css" media="all">
    <link rel="stylesheet" type="text/css" href="${baseurl}/public/common/css/global.css" media="all">
    <link rel="stylesheet" type="text/css" href="${baseurl}/public/css/common.css" media="all">
    <link rel="stylesheet" type="text/css" href="${baseurl}/public/css/personal.css" media="all">
    <script type="text/javascript" src="${baseurl}/public/common/js/jquery-3.2.0.min.js"></script>
    <script src="${baseurl}/public/common/layui/layui.js" charset="utf-8"></script>
</head>
<body>
<div class="layui-form" style="width: 98%;margin-left: 1%" id="questions">

</div>
<div id="view" style="display: none;width: 90%;margin-left: 5%;margin-bottom: 50px">

</div>

<div id="watchadd" style="display: none;width: 90%;margin-left: 5%;margin-bottom: 50px">

</div>
<script src="${baseurl}/public/js/layui/layui.js" charset="utf-8"></script>
<script>
    let _open;
    let _operating;
    //动态拼接测试题信息
    $(function () {

        layui.use(['jquery', 'layer', 'element', 'laypage', 'form', 'laytpl', 'tree', 'layedit'], function () {
            window.jQuery = window.$ = layui.jquery;
            window.layer = layui.layer;

            var element = layui.element(),
                form = layui.form(),
                layedit = layui.layedit,
                laytpl = layui.laytpl;

        });
        _open = {
            initialize: function () {
                var _html = "";
                _html += (`
                    <table class="layui-table">
                    <colgroup>
                    <col width="200">
                    <col width="200">
                    <col width="200">
                    <col width="200">
                    <col width="200">
                    <col>
                    </colgroup>
                    <thead>
                    <tr>
                    <th style="text-align: center">开放试题题目</th>
                    <th style="text-align: center">试题个数</th>
                    <th style="text-align: center">出题教师</th>
                    <th style="text-align: center">作答正确个数</th>
                    <th style="text-align: center">操作</th>
                    </tr>
                    </thead>`);
                $.post("${baseurl}/Testpaper/findOpenTest", function (data) {
                    console.log(data.data);
                    for (let i = 0; i < data.data.length; i++) {
                        let number = "未答题";
                        if (data.data[i].trueNum != null) {
                            number = data.data[i].trueNum
                        }
                        _html += (`<tbody>
                    <tr>
                    <td style="text-align: center">` + data.data[i].name + `</td>
                    <td style="text-align: center">` + data.data[i].num + `</td>
                    <td style="text-align: center">` + data.data[i].teacherName + `</td>
                    <td style="text-align: center"> ` + number + `</td>
                    <td style="text-align: center">
                    <a class="layui-btn  layui-btn-small layui-btn-normal " onclick="_operating.answer(` + data.data[i].id + `,'`+data.data[i].subject_id+`')">
                            <i class="layui-icon">&#xe642;</i>答题</a>
                    <a class="layui-btn  layui-btn-small" onclick="_operating.preview(`+data.data[i].id+`,'` + data.data[i].subject_id + `')">
                            <i class="layui-icon">&#xe60a;</i>预览</a>
                            </td>
                    </tr>
                </tbody>`);
                    }
                    _html += (`</table>`);
                    $("#questions").html(_html);
                });

            }
        };
        $(function () {
            _open.initialize();
        })
    });
    _operating = {
        answer: function (id,subject_id) {
            $.post("${baseurl}/Testpaper/findOpenTestById", {subject_id: subject_id}, function (data) {
                console.log(data.data)
            });
            layer.open({
                type: 1,
                title: "在线答题",
                area: ["100%", "100%"],
                skin: 'yourclass',
                content: $('#view')
            });
        },
        preview: function (id,subject_id) {
            $.post("${baseurl}/Testpaper/findOpenTestById", {subject_id: subject_id}, function (data) {
                console.log(data.data)
            });
            layer.open({
                type: 1,
                title: "试题预览",
                area: ["100%", "100%"],
                skin: 'yourclass',
                content: $('#watchadd')
            });
        }
    }
</script>
</body>
</html>
